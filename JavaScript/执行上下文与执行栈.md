### 从ES6的规范解读执行上下文(Execution Context)

> 执行上下文的类型

1. 全局执行上下文
2. 函数执行上下文
3. `Eval` 函数执行上下文

> 执行栈

执行上下文栈用于追踪执行上下文。运行执行 上下文始终是栈顶元素。当控制权从与当前运行的执行上下文中的可执行代码切换到与当前运行的执行上下文中不相关的可执行代码时，会创建一个新的执行上下文。新创建的执行上下文会被 push 到栈中，成为运行执行上下文。

假设当前执行上下文 A 是正在运行的执行上下文，一旦 A 被挂起，另一个执行上下文 B 会替换它，成为新的正在运行的执行上下文，并执行 B 中的代码。
经过一段时间后，挂起的执行上下文 A 可能再次成为正在运行的执行上下文，并在之前挂起的地方继续执行其代码。
正在运行的执行上下文状态在执行上下文中切换，通常以类似栈的后进先出方式发生。然而，一些 ECMAScript 特性需要运行执行上下文的不按照后进先出的方式切换。


![image](https://user-images.githubusercontent.com/25894364/125049057-234e7e00-e0d3-11eb-8316-4b73eac65719.png)

#### 执行上下文分为两个阶段

> 创建阶段


[Object 规范](https://262.ecma-international.org/5.1/#sec-9.9)

### Executable Code and Execution Contexts（可执行代码与执行上下文）

#### 词法环境

`词法环境`是一种规范类型，用于根据 `ECMAScript` 代码的词法嵌套结构定义标识符与特定变量和函数的关联。`词法环境`由`环境记录`和对`外部词法环境`的可能为`空`的引用组成。通常，`词法环境`与 `ECMAScript` 代码的某些特定句法结构相关联，例如 `FunctionDeclaration`、`WithStatement` 或 `TryStatement` 的 `Catch` 子句，并且每次评估此类代码时都会创建一个新的词法环境。

`环境记录记录`在其关联`词法环境`范围内创建的标识符绑定。

`外部环境`引用用于对`词法环境`值的逻辑嵌套进行建模。

（内部）词法环境的外部引用是对逻辑上围绕内部词法环境的词法环境的引用。 当然，外部词法环境可能有自己的外部词法环境。 一个`词法环境`可以作为多个`内部词法环境`的`外部环境`。例如，如果一个 `FunctionDeclaration` 包含两个嵌套的 `FunctionDeclaration`，那么每个嵌套函数的词法环境将把当前执行周围函数的词法环境作为它们的外部词法环境。

`词法环境`和`环境记录值`纯粹是规范机制，不需要对应于 `ECMAScript` 实现的任何特定人工制品。` ECMAScript` 程序不可能直接访问或操作这些值。


#### 环境记录







